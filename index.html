<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel de dispositivos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f2f2f2;
    color: #333;
    transition: background-color 0.5s, color 0.5s;
  }

  .container {
    max-width: 800px;
    margin: 50px auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    transition: background-color 0.5s, color 0.5s;
  }

  h1 {
    text-align: center;
  }

  .top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
  }

  .device {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #ccc;
    padding: 10px 0;
    margin-bottom: 10px;
  }

  .device-info {
    display: flex;
    align-items: center;
  }

  .device-info img {
    width: 50px;
    height: 50px;
    margin-right: 20px;
  }

  .device-info p {
    margin: 0;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 34px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: #007bff;
  }

  input:focus + .slider {
    box-shadow: 0 0 1px #007bff;
  }

  input:checked + .slider:before {
    -webkit-transform: translateX(26px);
    -ms-transform: translateX(26px);
    transform: translateX(26px);
  }

  .slider.round {
    border-radius: 34px;
  }

  .slider.round:before {
    border-radius: 50%;
  }

  .dark-mode {
    background-color: #333;
    color: #fff;
  }

  .dark-mode .container {
    background-color: #444;
    color: #fff;
  }

  .dark-mode .slider {
    background-color: #bbb;
  }

  .dark-mode input:checked + .slider {
    background-color: #4caf50;
  }

  .btn-dark-mode, .btn-logout, .btn-add-device, .btn-delete-device, .btn-edit-device {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s;
    margin-left: 10px;
  }

  .btn-dark-mode:hover {
    background-color: #0056b3;
  }

  .btn-logout {
    background-color: #dc3545;
  }

  .btn-logout:hover {
    background-color: #c82333;
  }

  .btn-add-device:hover {
    background-color: #0056b3;
  }

  .btn-edit-device {
    background-color: #ffc107;
  }

  .btn-edit-device:hover {
    background-color: #e0a800;
  }

  .btn-delete-device {
    background-color: #dc3545;
    margin-left: 5px;
  }

  .btn-delete-device:hover {
    background-color: #c82333;
  }

  .user-info {
    font-weight: bold;
  }

  /* Modal styles */
  .modal {
    display: none; 
    position: fixed; 
    z-index: 1; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgb(0,0,0); 
    background-color: rgba(0,0,0,0.4); 
    padding-top: 60px; 
  }

  .modal-content {
    background-color: #fefefe;
    margin: 5% auto; 
    padding: 20px;
    border: 1px solid #888;
    width: 80%; 
    max-width: 400px;
    border-radius: 8px;
    transition: background-color 0.5s, color 0.5s;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  .dark-mode .modal-content {
    background-color: #444;
    color: #fff;
  }

  .error-page {
    text-align: center;
    margin-top: 50px;
  }

  .error-page img {
    width: 50px;
    height: 50px;
  }

  #device-counter {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
  }

  #device-counter p {
    margin: 0 10px;
  }

  .device-actions {
    display: flex;
    align-items: center;
  }

  .device-actions .btn-delete-device,
  .device-actions .btn-edit-device {
    visibility: hidden;
  }

  .device:hover .device-actions .btn-delete-device,
  .device:hover .device-actions .btn-edit-device {
    visibility: visible;
  }

  .empty-message {
    text-align: center;
    margin-top: 20px;
    display: none;
  }

  .credits {
    text-align: center;
    margin-top: 20px;
    font-size: 12px;
  }

  .credits a {
    margin: 0 5px;
  }

  .social-icons {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .social-icons img {
    width: 30px;
    height: 30px;
    margin: 0 5px;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="app" style="display: none;">
  <div class="top-bar">
    <div class="user-info" id="user-info"></div>
    <div>
      <button class="btn-dark-mode" id="dark-mode-btn" onclick="toggleDarkMode()">Modo Oscuro</button>
      <button class="btn-logout" onclick="logout()">Cerrar Sesión</button>
      <button class="btn-add-device" onclick="showModal()">Agregar Dispositivo</button>
    </div>
  </div>
  <div class="container">
    <h1>Mis dispositivos</h1>
    <div id="device-list">
      <!-- Devices will be dynamically added here -->
    </div>
    <div id="device-counter" style="display: none;">
      <p>Dispositivos activos: <span id="active-count">0</span></p>
      <p>|</p>
      <p>Dispositivos inactivos: <span id="inactive-count">0</span></p>
    </div>
    <div id="empty-message" class="empty-message">
      <p>¡Hmm... está un poco vacío por aquí!</p>
    </div>
  </div>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>Agregar Nuevo Dispositivo</h2>
      <form onsubmit="addDevice(event)">
        <label for="device-name">Nombre:</label><br>
        <input type="text" id="device-name" name="device-name" required><br>
        <label for="device-ip">Dirección IP:</label><br>
        <input type="text" id="device-ip" name="device-ip" required><br>
        <label for="device-type">Tipo de Dispositivo:</label><br>
        <select id="device-type" name="device-type">
          <option value="camera">Cámara</option>
          <option value="switch">Switch</option>
          <option value="server">Servidor</option>
          <option value="access-point">Punto de Acceso</option>
          <option value="pc">PC o Equipo</option>
          <option value="router">Router</option>
          <option value="other">Otro</option>
        </select><br><br>
        <button type="submit" class="btn-add-device">Agregar</button>
      </form>
    </div>
  </div>

  <!-- Error Page -->
  <div id="error-page" class="error-page" style="display: none;">
    <img src="error.png" alt="Error">
    <h2>Error en la autenticación</h2>
    <button onclick="location.reload()">Recargar Página</button>
  </div>
</div>

<div class="credits">
  <p>Hecho con 💜 por NicoooDev</p>
</div>

<div class="social-icons">
  <a href="https://x.com/nicooolvshyo" target="_blank"><img src="twitter.png" alt="Twitter"></a>
  <a href="https://github.com/NicolasEtcheversss" target="_blank"><img src="github.png" alt="GitHub"></a>
  <a href="https://discord.gg/x2Du8FD3hN" target="_blank"><img src="discord.png" alt="Discord"></a>
</div>

<script>
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const darkModeBtn = document.getElementById('dark-mode-btn');
    if (document.body.classList.contains('dark-mode')) {
      darkModeBtn.textContent = 'Modo Claro';
    } else {
      darkModeBtn.textContent = 'Modo Oscuro';
    }
  }

  function notifyChange(device, status) {
    const state = status ? 'activo' : 'inactivo';
    alert(`El estado del dispositivo ${device} ha cambiado a ${state}.`);

    // Send notification to browser
    if (Notification.permission === 'granted') {
      new Notification(`Dispositivo ${device}`, {
        body: `Estado cambiado a ${state}`,
        icon: 'notification.png'
      });
    }

    updateDeviceCounter();
  }

  function logout() {
    localStorage.removeItem('authenticated');
    localStorage.removeItem('user');
    window.location.reload();
  }

  function showModal() {
    document.getElementById('myModal').style.display = "block";
  }

  function closeModal() {
    document.getElementById('myModal').style.display = "none";
  }

  function addDevice(event) {
    event.preventDefault();
    const name = document.getElementById('device-name').value;
    const ip = document.getElementById('device-ip').value;
    const type = document.getElementById('device-type').value;
    const icons = {
      camera: 'camera.png',
      switch: 'switch.png',
      server: 'server.png',
      pc: 'pc.png',
      router: 'router.png',
      'access-point': 'ap.png',
      other: 'other.png'
    };
    const icon = icons[type] || 'other.png';

    const deviceList = document.getElementById('device-list');
    const newDevice = document.createElement('div');
    newDevice.className = 'device';
    newDevice.innerHTML = `
      <div class="device-info">
        <img src="${icon}" alt="${name}">
        <p>${name} - ${ip}</p>
      </div>
      <div class="device-actions">
        <label class="switch">
          <input type="checkbox" onchange="notifyChange('${name} - ${ip}', this.checked)">
          <span class="slider round"></span>
        </label>
        <button class="btn-delete-device" onclick="confirmDeleteDevice(this)">×</button>
        <button class="btn-edit-device" onclick="editDevice('${name} - ${ip}')">Editar</button>
      </div>
    `;
    deviceList.appendChild(newDevice);
    closeModal();
    updateDeviceCounter();
    saveState();
  }

  function confirmDeleteDevice(button) {
    if (confirm('¿Estás seguro de que deseas eliminar este dispositivo?')) {
      deleteDevice(button);
    }
  }

  function deleteDevice(button) {
    const deviceElement = button.parentElement.parentElement;
    deviceElement.remove();
    updateDeviceCounter();
    saveState();
  }

  function editDevice(deviceName) {
    const newName = prompt('La funcion de editar permite solamente cambiar el nombre del dispositivo, si su IP cambio, debes borrarlo y volver a agregarlo. Ingresa el nuevo nombre:', deviceName.split(' - ')[0]);
    if (newName) {
      const deviceElement = findDeviceElement(deviceName);
      if (deviceElement) {
        const ip = deviceName.split(' - ')[1];
        const icon = deviceElement.querySelector('img').src;
        deviceElement.innerHTML = `
          <div class="device-info">
            <img src="${icon}" alt="${newName}">
            <p>${newName} - ${ip}</p>
          </div>
          <div class="device-actions">
            <label class="switch">
              <input type="checkbox" onchange="notifyChange('${newName} - ${ip}', this.checked)">
              <span class="slider round"></span>
            </label>
            <button class="btn-delete-device" onclick="confirmDeleteDevice(this)">×</button>
            <button class="btn-edit-device" onclick="editDevice('${newName} - ${ip}')">Editar</button>
          </div>
        `;
        alert(`El dispositivo ${deviceName} ha sido editado correctamente.`);
        updateDeviceCounter();
        saveState();
      }
    }
  }

  function findDeviceElement(deviceName) {
    const deviceElements = document.querySelectorAll('.device');
    for (let i = 0; i < deviceElements.length; i++) {
      const name = deviceElements[i].querySelector('.device-info p').textContent;
      if (name === deviceName) {
        return deviceElements[i];
      }
    }
    return null;
  }

  function updateDeviceCounter() {
    const switches = document.querySelectorAll('.device input[type="checkbox"]');
    let activeCount = 0;
    let inactiveCount = 0;
    switches.forEach(switchElem => {
      if (switchElem.checked) {
        activeCount++;
      } else {
        inactiveCount++;
      }
    });
    document.getElementById('active-count').textContent = activeCount;
    document.getElementById('inactive-count').textContent = inactiveCount;

    const deviceCounter = document.getElementById('device-counter');
    if (activeCount + inactiveCount === 0) {
      deviceCounter.style.display = 'none';
      document.getElementById('empty-message').style.display = 'block';
    } else {
      deviceCounter.style.display = 'flex';
      document.getElementById('empty-message').style.display = 'none';
    }
  }

  function saveState() {
    const devices = [];
    const deviceElements = document.querySelectorAll('.device');
    deviceElements.forEach(deviceElem => {
      const name = deviceElem.querySelector('.device-info p').textContent;
      const isChecked = deviceElem.querySelector('input[type="checkbox"]').checked;
      devices.push({ name, isChecked });
    });
    localStorage.setItem('devices', JSON.stringify(devices));
  }

  window.onload = function() {
    if (!localStorage.getItem('authenticated')) {
      const user = prompt('Usuario:');
      const pass = prompt('Clave:');
      if ((user === 'admin' && pass === 'admin') || (user === 'cliente' && pass === '1234')) {
        localStorage.setItem('authenticated', true);
        localStorage.setItem('user', user);
        document.getElementById('app').style.display = 'block';
        document.getElementById('error-page').style.display = 'none';
        document.getElementById('user-info').innerText = `Sesion iniciada como ${user}`;
        if (user === 'cliente') {
          document.querySelectorAll('.btn-edit-device, .btn-add-device, .btn-delete-device').forEach(btn => {
            btn.style.display = 'none';
          });
        }
      } else {
        document.getElementById('app').style.display = 'none';
        document.getElementById('error-page').style.display = 'block';
      }
    } else {
      const user = localStorage.getItem('user') || 'admin';
      document.getElementById('user-info').innerText = `Sesion iniciada como ${user}`;
      document.getElementById('app').style.display = 'block';
      document.getElementById('error-page').style.display = 'none';
    }

    // Restore saved devices state
    const savedDevices = JSON.parse(localStorage.getItem('devices')) || [];
    savedDevices.forEach(device => {
      const { name, isChecked } = device;
      const type = name.split(' ')[0].toLowerCase(); // Assuming device name format is "Nombre - IP"
      const icons = {
        camera: 'camera.png',
        switch: 'switch.png',
        server: 'server.png',
        pc: 'pc.png',
        router: 'router.png',
        'access-point': 'ap.png',
        other: 'other.png'
      };
      const icon = icons[type] || 'other.png';

      const deviceList = document.getElementById('device-list');
      const newDevice = document.createElement('div');
      newDevice.className = 'device';
      newDevice.innerHTML = `
        <div class="device-info">
          <img src="${icon}" alt="${name}">
          <p>${name}</p>
        </div>
        <div class="device-actions">
          <label class="switch">
            <input type="checkbox" ${isChecked ? 'checked' : ''} onchange="notifyChange('${name}', this.checked)">
            <span class="slider round"></span>
          </label>
          ${localStorage.getItem('user') === 'admin' ? `
          <button class="btn-delete-device" onclick="confirmDeleteDevice(this)">×</button>
          <button class="btn-edit-device" onclick="editDevice('${name}')">Editar</button>
          ` : ''}
        </div>
      `;
      deviceList.appendChild(newDevice);
    });

    updateDeviceCounter();
  };

</script>
</body>
</html>
